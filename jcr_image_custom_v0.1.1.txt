# Name: jcr_image_custom v0.1.1 
# Type: Admin/Public plugin
# Adds a custom field to the images panel
# Author: jcr / txpbuilders
# URL: http://txp.builders
# Recommended load order: 5

# .....................................................................
# This is a plugin for Textpattern CMS - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# .....................................................................

YToxNTp7czo0OiJuYW1lIjtzOjE2OiJqY3JfaW1hZ2VfY3VzdG9tIjtzOjc6InZlcnNpb24i
O3M6NToiMC4xLjEiO3M6ODoicmV2aXNpb24iO3M6MDoiIjtzOjY6ImF1dGhvciI7czoxNzoi
amNyIC8gdHhwYnVpbGRlcnMiO3M6MTA6ImF1dGhvcl91cmkiO3M6MTk6Imh0dHA6Ly90eHAu
YnVpbGRlcnMiO3M6MTE6ImRlc2NyaXB0aW9uIjtzOjM5OiJBZGRzIGEgY3VzdG9tIGZpZWxk
IHRvIHRoZSBpbWFnZXMgcGFuZWwiO3M6NToib3JkZXIiO3M6MToiNSI7czo0OiJ0eXBlIjtz
OjE6IjEiO3M6NToiZmxhZ3MiO3M6MToiMiI7czo4OiJ0ZXh0cGFjayI7czoxMDA6IiNAYWRt
aW4KI0BsYW5ndWFnZSBlbi1nYgpqY3JfaW1hZ2VfY3VzdG9tID0+IFZpZGVvIElECiNAbGFu
Z3VhZ2UgZGUtZGUKamNyX2ltYWdlX2N1c3RvbSA9PiBWaWRlbyBJRAoiO3M6MTA6ImxvYWRf
b3JkZXIiO3M6MToiNSI7czo0OiJoZWxwIjtzOjMzMjY6IjxoMT5qY3JfaW1hZ2VfY3VzdG9t
PC9oMT4KCjxwPkFkZHMgYSBzaW5nbGUgZXh0cmEgY3VzdG9tIGZpZWxkIG9mIHVwIHRvIDI1
NSBjaGFyYWN0ZXJzIHRvIHRoZSA8YSBocmVmPSJodHRwOi8vZG9jcy50ZXh0cGF0dGVybi5p
by9hZG1pbmlzdHJhdGlvbi9pbWFnZXMtcGFuZWwiPkNvbnRlbnQg4oC6IEltYWdlczwvYT4g
cGFuZWwgYW5kIHByb3ZpZGVzIGEgY29ycmVzcG9uZGluZyB0YWcgdG8gb3V0cHV0IHRoZSBj
dXN0b20gZmllbGQuPC9wPgoKCjxoMj5Vc2UgY2FzZXM8L2gyPgoKPHA+VXNlIHdoZW5ldmVy
IGV4dHJhIGluZm9ybWF0aW9uIG5lZWRzIHRvIGJlIHN0b3JlZCB3aXRoIGFuIGltYWdlLiBG
b3IgZXhhbXBsZTo8L3A+Cgo8dWw+Cgk8bGk+U3RvcmUgYSB5b3V0dWJlL3ZpbWVvIGxpbmsg
b3IgdmlkZW8tSUQgd2l0aCBhbiBpbWFnZSBmb3IgZ2VuZXJhdGluZyBjdXN0b20gdmlkZW8g
cG9zdGVyIGltYWdlcy48L2xpPgoJPGxpPlN0b3JlIHRoZSBkb3dubG9hZCB1cmwgb2YgYSBj
b3JyZXNwb25kaW5nIGhpLXJlcyBwcmVzcyBpbWFnZSBub3Qgc3RvcmVkIGluIHR4cC48L2xp
PgoJPGxpPuKApjwvbGk+CjwvdWw+CgoKPGgyIGlkPSJpbnN0YWxsYXRpb24iPkluc3RhbGxh
dGlvbjwvaDI+Cgo8cD5QYXN0ZSB0aGUgY29kZSBpbnRvIHRoZSAgPGVtPkFkbWluIOKAuiBQ
bHVnaW5zPC9lbT4gcGFuZWwsIGluc3RhbGwgYW5kIGVuYWJsZSB0aGUgcGx1Z2luLjwvcD4K
Cgo8aDIgaWQ9InRhZ3MiPlRhZ3M8L2gyPgoKPHByZT48Y29kZT4mbHQ7dHhwOmpjcl9pbWFn
ZV9jdXN0b20gLyZndDs8L2NvZGU+PC9wcmU+Cgo8cD5PdXRwdXRzIHRoZSBjb250ZW50IG9m
IHRoZSBpbWFnZSBjdXN0b20gZmllbGQuPC9wPgoKPGgzPlRhZyBhdHRyaWJ1dGVzPC9oMz4K
CjxwPjxzdHJvbmc+ZXNjYXBlPC9zdHJvbmc+PGJyIC8+CkVzY2FwZSA8c3BhbiBjbGFzcz0i
Y2FwcyI+SFRNTDwvc3Bhbj4gZW50aXRpZXMgc3VjaCBhcyA8Y29kZT4mbHQ7PC9jb2RlPiwg
PGNvZGU+Jmd0OzwvY29kZT4gYW5kIDxjb2RlPiZhbXA7PC9jb2RlPiBwcmlvciB0byBlY2hv
aW5nIHRoZSBmaWVsZCBjb250ZW50cy48YnIgLz4KRXhhbXBsZTogVXNlIDxjb2RlPmVzY2Fw
ZT0mcXVvdDsmcXVvdDs8L2NvZGU+IHRvIHN1cHByZXNzIGNvbnZlcnNpb24uIERlZmF1bHQ6
IDxjb2RlPmh0bWw8L2NvZGU+LjwvcD4KCgo8aDIgaWQ9ImV4YW1wbGVzIj5FeGFtcGxlPC9o
Mj4KCjxwPlByb2R1Y2UgYSBnYWxsZXJ5IG9mIGN1c3RvbSB2aWRlbyBwb3N0ZXItaW1hZ2Vz
IChmcm9tIGltYWdlcyBhc3NpZ25lZCB0byB0aGUgaW1hZ2UgY2F0ZWdvcnkgJiM4MjIwO3Zp
ZGVvcyYjODIyMTspIHRoYXQgb3BlbiBhIGNvcnJlc3BvbmRpbmcgeW91dHViZSB2aWRlbyAo
ZGVmaW5lZCBpbiB0aGUgaW1hZ2UgY3VzdG9tIGZpZWxkKSBpbiBhIGxpZ2h0Ym94IG1vZGFs
OjwvcD4KCjxwcmU+PGNvZGU+Jmx0O3R4cDppbWFnZXMgd3JhcHRhZz0mcXVvdDt1bCZxdW90
OyBicmVhaz0mcXVvdDtsaSZxdW90OyBjYXRlZ29yeT0mcXVvdDt2aWRlb3MmcXVvdDsgY2xh
c3M9JnF1b3Q7dmlkZW8tZ2FsbGVyeSZxdW90OyZndDsKICAmbHQ7YSBocmVmPSZxdW90Oy8v
d3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9Jmx0O3R4cDpqY3JfaW1hZ2VfY3VzdG9tIC8mZ3Q7
JnF1b3Q7IHRpdGxlPSZxdW90OyZsdDt0eHA6aW1hZ2VfaW5mbyB0eXBlPSZxdW90O2NhcHRp
b24mcXVvdDsgLyZndDsmcXVvdDsgZGF0YS1saXR5Jmd0OwogICAgJmx0O3R4cDp0aHVtYm5h
aWwgLyZndDsKICAmbHQ7L2EmZ3Q7CiZsdDsvdHhwOmltYWdlcyZndDs8L2NvZGU+PC9wcmU+
Cgo8cD53aGVyZSB0aGUgaW1hZ2UgY3VzdG9tIGZpZWxkIGlzIHVzZWQgdG8gc3RvcmUgdGhl
IFZpZGVvIElEIG9mIHRoZSBZb3VUdWJlIHZpZGVvLiBUaGlzIGV4YW1wbGUgdXNlcyB0aGUg
PGEgaHJlZj0iaHR0cDovL3NvcmdhbGxhLmNvbS9saXR5LyI+bGl0eTwvYT4gbGlnaHRib3gg
c2NyaXB0LjwvcD4KCgo8aDI+Q2hhbmdpbmcgdGhlIGxhYmVsIG9mIHRoZSBjdXN0b20gZmll
bGQ8L2gyPgoKPHA+VGhlIG5hbWUgb2YgY3VzdG9tIGZpZWxkIGNhbiBiZSBjaGFuZ2VkIGJ5
IHNwZWNpZnlpbmcgYSBuZXcgbGFiZWwgdXNpbmcgdGhlIDxlbT5JbnN0YWxsIGZyb20gVGV4
dHBhY2s8L2VtPiBmaWVsZCBpbiB0aGUgPGEgaHJlZj0iaHR0cDovL2RvY3MudGV4dHBhdHRl
cm4uaW8vYWRtaW5pc3RyYXRpb24vbGFuZ3VhZ2VzLXBhbmVsLmh0bWwiPkFkbWluIOKAuiBM
YW5ndWFnZXM8L2E+IHBhbmVsLiBFbnRlciB5b3VyIG93biBpbmZvcm1hdGlvbiBpbiB0aGUg
Zm9sbG93aW5nIHBhdHRlcm4gYW5kIGNsaWNrIDxzdHJvbmc+VXBsb2FkPC9zdHJvbmc+Ojwv
cD4KCjxwcmU+PGNvZGU+I0BhZG1pbgojQGxhbmd1YWdlIGVuLWdiCmpjcl9pbWFnZV9jdXN0
b20gPSZndDsgWW91ciBsYWJlbDwvY29kZT48L3ByZT4KCjxwPnJlcGxhY2luZyA8Y29kZT5l
bi1nYjwvY29kZT4gd2l0aCB5b3VyIG93biBsYW5ndWFnZSBhbmQgPGNvZGU+WW91ciBsYWJl
bDwvY29kZT4gd2l0aCB5b3VyIG93biBkZXNpcmVkIGxhYmVsLjwvcD4KCgo8aDIgaWQ9ImRl
aW5zdGFsbGF0aW9uIj5EZS1pbnN0YWxsYXRpb248L2gyPgoKPHA+VGhlIHBsdWdpbiBjbGVh
bnMgdXAgYWZ0ZXIgaXRzZWxmOiBkZWluc3RhbGxpbmcgdGhlIHBsdWdpbiByZW1vdmVzIHRo
ZSBleHRyYSBjb2x1bW4gZnJvbSB0aGUgZGF0YWJhc2UuIFRvIHN0b3AgdXNpbmcgdGhlIHBs
dWdpbiBidXQga2VlcCB0aGUgZGF0YWJhc2UgdGFibGVzLCBqdXN0IGRpc2FibGUgKGRlYWN0
aXZhdGUpIHRoZSBwbHVnaW4gYnV0IGRvbiYjODIxNzt0IGRlbGV0ZSBpdC48L3A+CgoKPGgy
IGlkPSJjaGFuZ2Vsb2ciPkNoYW5nZWxvZzwvaDI+Cgo8aDM+VmVyc2lvbiAwLjEuMSDigJMg
MjAxNi8xMi8wNTwvaDM+Cgo8dWw+Cgk8bGk+UmVtZWR5IHRhYmxlIG5vdCBiZWluZyBjcmVh
dGVkIG9uIGluc3RhbGw8L2xpPgo8L3VsPgoKPGgzPlZlcnNpb24gMC4xIOKAkyAyMDE2LzA0
LzE2PC9oMz4KCjx1bD4KCTxsaT5GaXJzdCByZWxlYXNlPC9saT4KPC91bD4KCgo8aDIgaWQ9
ImNyZWRpdHMiPkNyZWRpdHM8L2gyPgoKPHA+Um9iZXJ0IFdldHpsbWF5cuKAmXMgPGEgaHJl
Zj0iaHR0cHM6Ly9naXRodWIuY29tL3J3ZXR6bG1heXIvd2V0X3Byb2ZpbGUiPndldF9wcm9m
aWxlPC9hPiBwbHVnaW4gZm9yIHRoZSBzdGFydGluZyBwb2ludCwgYW5kIGZ1cnRoZXIgZXhh
bXBsZXMgYnkgPGEgaHJlZj0iaHR0cDovL3d3dy5zdGVmZGF3c29uLmNvbSI+U3RlZiBEYXdz
b248L2E+IGFuZCA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vZ29jb20iPkp1a2thIFN2
YWhuPC9hPi48L3A+IjtzOjM6ImNzcyI7czowOiIiO3M6NDoiY29kZSI7czoyNzExOiJjbGFz
cyBqY3JfaW1hZ2VfY3VzdG9tCnsKCS8qKgoJICogSW5pdGlhbGlzZS4KCSAqLwoJIGZ1bmN0
aW9uIF9fY29uc3RydWN0KCkKCXsKCQlyZWdpc3Rlcl9jYWxsYmFjayhhcnJheShfX0NMQVNT
X18sICdsaWZlY3ljbGUnKSwgJ3BsdWdpbl9saWZlY3ljbGUuamNyX2ltYWdlX2N1c3RvbScp
OwoJCXJlZ2lzdGVyX2NhbGxiYWNrKGFycmF5KF9fQ0xBU1NfXywgJ3VpJyksICdpbWFnZV91
aScsICdleHRlbmRfZGV0YWlsX2Zvcm0nKTsKCQlyZWdpc3Rlcl9jYWxsYmFjayhhcnJheShf
X0NMQVNTX18sICdzYXZlJyksICdpbWFnZScsICdpbWFnZV9zYXZlJyk7Cgl9CgogIC8qKgog
ICAqIEFkZCBhbmQgcmVtb3ZlIGN1c3RvbSBmaWVsZCBmcm9tIHR4cF9pbWFnZSB0YWJsZS4K
ICAgKgogICAqIEBwYXJhbSAkZXZlbnQgc3RyaW5nCiAgICogQHBhcmFtICRzdGVwIHN0cmlu
ZyAgVGhlIGxpZmVjeWNsZSBwaGFzZSBvZiB0aGlzIHBsdWdpbgogICAqLwogIHB1YmxpYyBz
dGF0aWMgZnVuY3Rpb24gbGlmZWN5Y2xlKCRldmVudCwgJHN0ZXApCiAgewogICAgICBzd2l0
Y2ggKCRzdGVwKSB7CiAgICAgICAgICBjYXNlICdlbmFibGVkJzoKICAgICAgICAgICAgICBi
cmVhazsKICAgICAgICAgIGNhc2UgJ2Rpc2FibGVkJzoKICAgICAgICAgICAgICBicmVhazsK
ICAgICAgICAgIGNhc2UgJ2luc3RhbGxlZCc6CiAgICAgICAgICAgICAgc2FmZV9hbHRlcigK
ICAgICAgICAgICAgICAgICd0eHBfaW1hZ2UnLAogICAgICAgICAgICAgICAgJ0FERCBDT0xV
TU4gamNyX2ltYWdlX2N1c3RvbSBWQVJDSEFSKDI1NSkgTlVMTCBBRlRFUiB0aHVtYl9oJwog
ICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdk
ZWxldGVkJzoKICAgICAgICAgICAgICBzYWZlX2FsdGVyKAogICAgICAgICAgICAgICAgJ3R4
cF9pbWFnZScsCiAgICAgICAgICAgICAgICAnRFJPUCBDT0xVTU4gamNyX2ltYWdlX2N1c3Rv
bScKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAg
IHJldHVybjsKICB9CgoJLyoqCgkgKiBQYWludCBhZGRpdGlvbmFsIGZpZWxkcyBmb3IgaW1h
Z2UgY3VzdG9tIGZpZWxkCgkgKgoJICogQHBhcmFtICRldmVudCBzdHJpbmcKCSAqIEBwYXJh
bSAkc3RlcCBzdHJpbmcKCSAqIEBwYXJhbSAkZHVtbXkgc3RyaW5nCgkgKiBAcGFyYW0gJHJz
IGFycmF5IFRoZSBjdXJyZW50IGltYWdlJ3MgZGF0YQoJICogQHJldHVybiBzdHJpbmcKCSAq
LwoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiB1aSgkZXZlbnQsICRzdGVwLCAkZHVtbXksICRy
cykKCXsKCQlleHRyYWN0KGxBdHRzKGFycmF5KAoJCQknamNyX2ltYWdlX2N1c3RvbScgPT4g
JycKCQkpLCAkcnMsIDApKTsKCgkJcmV0dXJuCgkJCWlucHV0TGFiZWwoJ2pjcl9pbWFnZV9j
dXN0b20nLCBmSW5wdXQoJ3RleHQnLCAnamNyX2ltYWdlX2N1c3RvbScsICRqY3JfaW1hZ2Vf
Y3VzdG9tLCAnJywgJycsICcnLCBJTlBVVF9SRUdVTEFSLCAnJywgJ2pjcl9pbWFnZV9jdXN0
b20nKSwgJ2pjcl9pbWFnZV9jdXN0b20nKS5uOwoJfQoKCS8qKgoJICogU2F2ZSBhZGRpdGlv
bmFsIGltYWdlIGN1c3RvbSBmaWVsZHMKCSAqCgkgKiBAcGFyYW0gJGV2ZW50IHN0cmluZwoJ
ICogQHBhcmFtICRzdGVwIHN0cmluZwoJICovCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHNh
dmUoJGV2ZW50LCAkc3RlcCkKCXsKCQlleHRyYWN0KGRvU2xhc2gocHNhKGFycmF5KCdqY3Jf
aW1hZ2VfY3VzdG9tJywgJ2lkJykpKSk7CgkJJGlkID0gYXNzZXJ0X2ludCgkaWQpOwoJCXNh
ZmVfdXBkYXRlKCd0eHBfaW1hZ2UnLAoJCSAgImpjcl9pbWFnZV9jdXN0b20gPSAnJGpjcl9p
bWFnZV9jdXN0b20nIiwKCQkJImlkID0gJGlkIgoJCSk7Cgl9Cn0KCmlmICh0eHBpbnRlcmZh
Y2UgPT09ICdhZG1pbicpIHsKCiAgICBuZXcgamNyX2ltYWdlX2N1c3RvbTsKCn0gZWxzZWlm
ICh0eHBpbnRlcmZhY2UgPT09ICdwdWJsaWMnKSB7CgogICAgaWYgKGNsYXNzX2V4aXN0cygn
XFRleHRwYXR0ZXJuXFRhZ1xSZWdpc3RyeScpKSB7CiAgICAgICAgVHhwOjpnZXQoJ1xUZXh0
cGF0dGVyblxUYWdcUmVnaXN0cnknKQogICAgICAgICAgICAtPnJlZ2lzdGVyKCdqY3JfaW1h
Z2VfY3VzdG9tJyk7CiAgICB9Cgp9CgogIC8qKgogICAqIFB1YmxpYyB0YWc6IE91dHB1dCBj
dXN0b20gaW1hZ2UgZmllbGQKICAgKiBAcGFyYW0gIHN0cmluZyAkYXR0c1tlc2NhcGVdIENv
bnZlcnQgc3BlY2lhbCBjaGFyYWN0ZXJzIHRvIEhUTUwgZW50aXRpZXMuCiAgICogQHJldHVy
biBzdHJpbmcgIGN1c3RvbSBmaWVsZCBvdXRwdXQKICAgKiA8Y29kZT4KICAgKiAgICAgICAg
PHR4cDpqY3JfaW1hZ2VfY3VzdG9tIGVzY2FwZT0iaHRtbCIgLz4KICAgKiA8L2NvZGU+CiAg
ICovCgogICAgZnVuY3Rpb24gamNyX2ltYWdlX2N1c3RvbSgkYXR0cykKICAgIHsKICAgICAg
ICBnbG9iYWwgJHRoaXNpbWFnZTsKCiAgICAgICAgYXNzZXJ0X2ltYWdlKCk7CgogICAgICAg
IGV4dHJhY3QobEF0dHMoYXJyYXkoCiAgICAgICAgICAgICdlc2NhcGUnID0+ICdodG1sJywK
ICAgICAgICApLCAkYXR0cykpOwoKICAgICAgICByZXR1cm4gKCRlc2NhcGUgPT0gJ2h0bWwn
KQogICAgICAgICAgICA/IHR4cHNwZWNpYWxjaGFycygkdGhpc2ltYWdlWydqY3JfaW1hZ2Vf
Y3VzdG9tJ10pCiAgICAgICAgICAgIDogJHRoaXNpbWFnZVsnamNyX2ltYWdlX2N1c3RvbSdd
OwogICAgfSI7czozOiJtZDUiO3M6MzI6ImQ3NjU0OTgzMzg5MGI1MTg1ZTM2ZjQ3ZTk5YWE5
YTE4Ijt9
